"undefined"==typeof window.ThemeTools&&(window.ThemeTools={});ThemeTools.ErrorsRenderer=function(e){"object"==typeof e?jQuery.extend(!0,this,e):this.containerSelector=e;this._init()};ThemeTools.ErrorsRenderer.prototype={containerSelector:"",errors:null,fieldsAttribute:"name",errorWraper:{typeOutput:"after",className:"wrap-error",tag:"div"},render:function(e){this.reset();if(jQuery.isEmptyObject(e))return;for(var t in e)this._renderFieldErrors(t,e[t])},reset:function(){var e=this._getFields();for(var t in e)this._getErrorWraper(t,!0).remove()},_init:function(){if(!this.containerSelector)throw"ErrorRenderer: containerSelector is empty.";if(jQuery(this.containerSelector).length<1)throw'ErrorRenderer: containerSelector is not found ("'+this.containerSelector+'").';if(this.errors){this.render(this.errors);delete this.errors}},_renderFieldErrors:function(e,t){jQuery.isArray(t)&&(t=t.join("<br>"));if(!t)return;this._getErrorWraper(e).html(t)},_getFields:function(){var e=this,t={},n=this._getContainer().find("input,textarea,select").filter("["+this.fieldsAttribute+"]");n.each(function(n,r){var r=jQuery(this);t[r.attr(e.fieldsAttribute)]=r});return t},_getField:function(e){var t,n=this._getFields();"undefined"==typeof n[e]?t=jQuery():t=n[e];return t},_getContainer:function(){return jQuery(this.containerSelector)},_getErrorWraper:function(e,t){var n=this._getField(e),r=n.parent().find("."+this.errorWraper.className);if(r.length<1&&!t){var i=this.errorWraper.typeOutput,s="<"+this.errorWraper.tag+' class="'+this.errorWraper.className+'"></'+this.errorWraper.tag+">";switch(i){case"exists":throw'ErrorRenderer: errorWraperEl for item:("'+e+'") not found, type output "'+i+'" selector "'+errorWraperSelector+'".';case"before":r=jQuery(s).insertBefore(n);break;case"after":default:r=jQuery(s).insertAfter(n)}}return r}};ThemeTools.ErrorsRendererSet=function(e){e&&jQuery.extend(!0,this,e);this._init()};ThemeTools.ErrorsRendererSet.prototype={containerSelector:"",itemSelector:"",rowRendererConfig:{_getFields:function(){var e=this,t={},n=this._getContainer().find("input,textarea,select").filter("["+this.fieldsAttribute+"]");n.each(function(n,r){var r=jQuery(this),i=r.attr(e.fieldsAttribute),s=i.match(/\[\d+\]\[(\w+)\](\[\])?$/);s&&(i=s[1]);t[i]=r});return t}},_init:function(){if(!this.containerSelector)throw'Option "containerSelector" is required.';if(!this.itemSelector)throw'Option "itemSelector" is required.'},render:function(e){var t=this._getItemRenderers(),n;e||(e={});for(n in t){t[n].render(e[n]?e[n]:null);"undefined"!=e[n]&&delete e[n]}if(!jQuery.isEmptyObject(e)){var r=[],i;for(i in e){var s=e[i];"string"==typeof s?r.push(s):r=r.concat(s)}r.length>0&&alert(r.join("\n"))}},_getItemRenderers:function(){var e=this._renderersCache||{},t={},n=this;this._getContainer().find(this.itemSelector).each(function(r,i){if(e[r]&&e[r].containerSelector==i)t[r]=e[r];else{var s=jQuery.extend({},n.rowRendererConfig);s.containerSelector=i;t[r]=new ThemeTools.ErrorsRenderer(s)}});return t},_getContainer:function(){return jQuery(this.containerSelector)}};